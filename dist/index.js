!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("deltav")):"function"==typeof define&&define.amd?define(["deltav"],t):"object"==typeof exports?exports["deltav-quick-surface"]=t(require("deltav")):e["deltav-quick-surface"]=t(e.deltav)}(window,(function(e){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=3)}([function(t,r){t.exports=e},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0);t.isInstanceHandler=function(e){return"function"==typeof e},t.isQuickView=function(e){return Boolean(e&&e.viewport)},t.isLayerInitializer=function(e){return void 0!==e&&Boolean(void 0!==e.key&&e.init)},t.isLayerRef=function(e){return void 0!==e&&void 0!==e.easing},t.isInstanceType=function(e){return Boolean(e&&Array.isArray(e))},t.isInstanceProvider=function(e){return e instanceof n.InstanceProvider}},function(e,t,r){"use strict";var n=this&&this.__assign||function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)},a=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,i){function o(e){try{s(n.next(e))}catch(e){i(e)}}function u(e){try{s(n.throw(e))}catch(e){i(e)}}function s(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,u)}s((n=n.apply(e,t||[])).next())}))},i=this&&this.__generator||function(e,t){var r,n,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;o;)try{if(r=1,n&&(a=2&i[0]?n.return:i[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,i[1])).done)return a;switch(n=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,n=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(e){i=[6,e],n=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var i=arguments[t],o=0,u=i.length;o<u;o++,a++)n[a]=i[o];return n};Object.defineProperty(t,"__esModule",{value:!0});var u=r(0),s=r(1),c=r(6),l=r(7),f=r(8),p=r(9),d=r(10),y=r(11),h=r(12);t.view=function(e){return e};var v=function(){function e(e){var t=this;this.defaultCamera=new u.Camera2D,this.defaultManager=new u.BasicCamera2DController({camera:this.defaultCamera,ignoreCoverViews:!0,startView:["default-view.default-view"]}),this.eventManagers={},this.mouseQueuedHandlers=[],this.touchQueuedHandlers=[],this._ready=new u.PromiseResolver,this.destroy=function(){t.base&&(t.base.destroy(),delete t.base),t.eventProcessingLoopId&&u.stopAnimationLoop(t.eventProcessingLoopId)},this.handleEvents=function(){for(var e,r,n=0,a=t.mouseQueuedHandlers.length;n<a;++n){if(0!==(f=(l=t.mouseQueuedHandlers[n]).process()).length){for(var i=Object.assign({},f[0][0]),u=1,s=f.length;u<s;++u){var c=f[u][0];(e=i.instances).splice.apply(e,o([i.instances.length,0],c.instances))}l.baseHandler(i)}}for(n=0,a=t.touchQueuedHandlers.length;n<a;++n){var l,f;if(0!==(f=(l=t.touchQueuedHandlers[n]).process()).length){for(i=Object.assign({},f[0][0]),u=1,s=f.length;u<s;++u){c=f[u][0];(r=i.instances).splice.apply(r,o([i.instances.length,0],c.instances))}l.baseHandler(i)}}},this.options=Object.assign({background:[0,0,0,0]},e),this.init()}return Object.defineProperty(e.prototype,"ready",{get:function(){return this._ready.promise},enumerable:!0,configurable:!0}),e.prototype.createEventHandlerQueues=function(){var e=this;["onMouseClick","onMouseDown","onMouseMove","onMouseOut","onMouseOver","onMouseUp","onMouseUpOutside"].forEach((function(t){var r=e.options[t];r&&d.mapLookupValues("Handlers",s.isInstanceHandler,r,(function(r,n){var a=new y.QueuedHandler(n),i=l.getProp(e.layers,r);i&&((s.isLayerInitializer(i)?[i]:f.lookupValues(s.isLayerInitializer,i)).forEach((function(e){e.init[1].picking=u.PickType.SINGLE,e.init[1][t]=a.createHandler()})),e.mouseQueuedHandlers.push(a))}))})),["onTap","onTouchAllEnd","onTouchAllOut","onTouchDown","onTouchMove","onTouchOut","onTouchOut","onTouchOver","onTouchUp","onTouchUpOutside"].forEach((function(t){var r=e.options[t];r&&d.mapLookupValues("Handlers",s.isInstanceHandler,r,(function(r,n){var a=new y.QueuedHandler(n),i=l.getProp(e.layers,r);i&&((s.isLayerInitializer(i)?[i]:f.lookupValues(s.isLayerInitializer,i)).forEach((function(e){e.init[1].picking=u.PickType.SINGLE,e.init[1][t]=a.createHandler()})),e.touchQueuedHandlers.push(a))}))})),this.eventProcessingLoopId&&u.stopAnimationLoop(this.eventProcessingLoopId),this.eventProcessingLoopId=u.onAnimationLoop(this.handleEvents)},e.prototype.createLayerInitializer=function(t,r,a){if(s.isInstanceType(a)){var i,o,c=a[0];if(!c)return;if(p.loopInheritance(c,(function(t){var r=e.instanceLayerMap.get(t);if(r)return i=r.type,o=r.defaults(c),!0})),i&&o){var l=e.layerResourceMap.get(i);l||p.loopInheritance(i,(function(t){l=e.layerResourceMap.get(t)}));var f=u.Layer.createRef(),d=u.createLayer(i,n(n(n({},o),{key:t.join("."),data:r,ref:f}),l));return h.setProp(this.layers,d,t),h.setProp(this.refs,f,t),d}console.warn("Could not find a suitable layer for the provided instances.")}return null},e.prototype.createProvidersAndLayers=function(){var e=this,t=this.options.data;if(t){delete this.options.data,this.layers={},this.refs={};var r=d.mapLookupValues("providers",s.isInstanceType,t,(function(t,r){Array.isArray(r)||(r=[r]);for(var n=new u.InstanceProvider,a=0,i=r.length;a<i;++a){var o=r[a];n.add(o)}return e.createLayerInitializer(t,n,r),n}));this.data=r}},e.prototype.createScenesAndViews=function(){var e,t=this,r=this.options.views,n=[this.defaultManager],a=[],i={viewport:{left:0,right:0,bottom:0,top:0},camera:this.defaultCamera,manager:this.defaultManager},o={};if(d.mapLookupValues("views",s.isLayerInitializer,this.layers,(function(e,t){h.setProp(o,t,e)})),r){var u=[];d.mapLookupValues("views",s.isQuickView,r,(function(e,r){var i=l.getProp(o,e);if(i){if(s.isLayerInitializer(i)){var c=t.createViewInitializers(e,[i],r);a=a.concat(c)}else{var p=f.lookupValues(s.isLayerInitializer,i),d=t.createViewInitializers(e,p,r);a=a.concat(d)}u.push(e),r.manager&&(Array.isArray(r.manager)?n.push.apply(n,r.manager):n.push(r.manager))}})),u.forEach((function(e){return c.deleteProp(o,e)}))}for(var p=f.lookupValues(s.isLayerInitializer,o),y=this.createViewInitializers(["default-view"],p,i),v={},g=0,b=(a=y.concat(a)).length;g<b;++g){var M=a[g],m=M[0],w={layers:M[1],views:(e={},e[m.key]=m,e)};h.setProp(v,w,m.key.split("."))}this.scenes=v,n.forEach((function(e,r){t.eventManagers[r]=e}))},e.prototype.createViewInitializers=function(t,r,a){for(var i=this,o=new Map,s=new Set,c=0,l=r.length;c<l;++c){var f=r[c],p=f.init[0],d=e.layerViewMap.get(p);if(d){var y=o.get(d);y||(y=[],o.set(d,y)),y.push(f)}else s.has(p)&&(console.warn("Quick Surface could not determine a View type appropriate for the inferred layer type.","All elements that require this layer type will not be rendered.","Layer:",p),s.add(p))}var h=[],v=-1;return o.forEach((function(e,r){var s=t;o.size>1&&(s=s.concat(""+ ++v));var c=u.createView(r.type,n(n({},r.defaults),{key:s.join("."),camera:a.camera||new u.ReferenceCamera2D({base:i.defaultCamera}),viewport:a.viewport}));h.push([c,e])})),h},e.prototype.fitContainer=function(e){this.base&&this.base.fitContainer(e)},e.prototype.init=function(){return a(this,void 0,void 0,(function(){var t,r,a,o=this;return i(this,(function(i){switch(i.label){case 0:return this.base?[2]:(this.createProvidersAndLayers(),this.createEventHandlerQueues(),this.createScenesAndViews(),t=getComputedStyle(this.options.container),e.defaultResources.defaultFont.fontSource.family=t.fontFamily,this.base=new u.BasicSurface({container:this.options.container,providers:this.data,resources:e.defaultResources,cameras:{},handlesWheelEvents:!0,rendererOptions:n({alpha:!1,antialias:!0},this.options.rendererOptions),eventManagers:function(){return o.eventManagers},scenes:function(){return o.scenes},onNoWebGL:function(){var e,t;return null===(t=(e=o.options).onNoWebGL)||void 0===t?void 0:t.call(e)}}),[4,this.base.ready]);case 1:return i.sent(),r=f.lookupValues(s.isLayerRef,this.refs),a=r.map((function(e){var t;return null===(t=e.easing)||void 0===t?void 0:t.complete()})).filter(u.isDefined),[4,Promise.all(a)];case 2:return i.sent(),this._ready.resolve(),[2]}}))}))},e.defaultResources={defaultAtlas:u.createAtlas({height:Math.min(u.WebGLStat.MAX_TEXTURE_SIZE,u.TextureSize._4096),width:Math.min(u.WebGLStat.MAX_TEXTURE_SIZE,u.TextureSize._4096)}),defaultFont:u.createFont({fontSource:{errorGlyph:"",family:"Verdana",size:64,weight:400,localKerningCache:!1,type:u.FontMapGlyphType.BITMAP,preload:u.preloadNumber()},dynamic:!0,fontMapSize:[Math.min(u.WebGLStat.MAX_TEXTURE_SIZE,u.TextureSize._4096),Math.min(u.WebGLStat.MAX_TEXTURE_SIZE,u.TextureSize._4096)]})},e.layerResourceMap=new Map,e.instanceLayerMap=new Map,e.layerViewMap=new Map,e.cameraReferenceMap=new Map,e}();t.QuickSurface=v},function(e,t,r){"use strict";function n(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}Object.defineProperty(t,"__esModule",{value:!0}),n(r(1)),n(r(4)),n(r(5)),r(13)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CONSTANTS_NOOP=function(){}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e){for(var r in e)t.hasOwnProperty(r)||(t[r]=e[r])}(r(2))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.deleteProp=function(e,t){var r=e;if(void 0===r)return r;for(var n=0,a=t.length-1;n<a;++n){if(null==(r=r[t[n]]))return!1}return null!=r&&delete r[t[t.length-1]]}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getProp=function(e,t){var r=e;if(void 0===r)return r;for(var n=0,a=t.length;n<a;++n){if(null==(r=r[t[n]]))return}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.lookupValues=function(e,t){for(var r=[],n=Object.values(t),a=0;a<n.length;++a){var i=n[a];e(i)?r.push(i):null!=i&&n.push.apply(n,Object.values(i))}return r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.loopInheritance=function(e,t){for(var r=Object.getPrototypeOf(e);null!==r;){if(t(r.constructor?r.constructor:r))break;r=Object.getPrototypeOf(r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mapLookupValues=function(e,t,r,n){for(var a=new Set,i={},o=Object.keys(r).map((function(e){return[[e],r[e]]})),u=function(r){var u=o[r];if(t(u[1]))for(var s=n(u[0],u[1]),c=u[0],l=i,f=0,p=c.length;f<p;++f){var d=c[f];f===c.length-1?l[d]=s:(l[d]||(l[d]={}),l=l[d])}else{var y=!1;if(Object.keys(u[1]).forEach((function(t){var r=u[1][t];a.has(r)?(y=!0,console.warn("Invalid lookup for mapping values detected:",e)):(o.push([u[0].concat(t),r]),a.add(r))})),y)return"break"}},s=0;s<o.length;++s){if("break"===u(s))break}return i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e){this.queue=[],this.baseHandler=e}return e.prototype.createHandler=function(){var e=this;return function(){for(var t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];e.queue.push(t)}},e.prototype.process=function(){var e=this.queue;return this.queue=[],e},e}();t.QueuedHandler=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setProp=function(e,t,r){for(var n=e,a=0,i=r.length-1;a<i;++a){var o=r[a];n=n[o]=n[o]||{}}return r.length>0&&(n[r[r.length-1]]=t,!0)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=r(0),a=r(2);a.QuickSurface.layerResourceMap.set(n.ImageLayer,{resourceKey:"defaultAtlas"}),a.QuickSurface.layerResourceMap.set(n.LabelLayer,{resourceKey:"defaultFont"}),a.QuickSurface.layerResourceMap.set(n.TextAreaLayer,{resourceKey:"defaultFont"}),a.QuickSurface.instanceLayerMap.set(n.CircleInstance,{type:n.CircleLayer,defaults:function(){return{animate:{center:n.AutoEasingMethod.easeInOutCubic(500),radius:n.AutoEasingMethod.easeBackOut(200)},data:new n.InstanceProvider,key:"",streamChanges:{count:1e3},usePoints:!0}}}),a.QuickSurface.instanceLayerMap.set(n.EdgeInstance,{type:n.EdgeLayer,defaults:function(e){var t=e;return{type:t.control.length>1?n.EdgeType.BEZIER2:t.control.length>0?n.EdgeType.BEZIER:n.EdgeType.LINE,animate:{start:n.AutoEasingMethod.easeInOutCubic(500),end:n.AutoEasingMethod.easeInOutCubic(500)},data:new n.InstanceProvider,key:"",streamChanges:{count:1e3}}}}),a.QuickSurface.instanceLayerMap.set(n.ArcInstance,{type:n.ArcLayer,defaults:function(){return{scaleType:n.ArcScaleType.NONE,animate:{angle:n.AutoEasingMethod.easeOutCubic(500),angleOffset:n.AutoEasingMethod.easeOutCubic(500),radius:n.AutoEasingMethod.easeOutCubic(500)},data:new n.InstanceProvider,key:"",streamChanges:{count:1e3}}}}),a.QuickSurface.instanceLayerMap.set(n.RingInstance,{type:n.RingLayer,defaults:function(){return{data:new n.InstanceProvider,key:"",animate:{center:n.AutoEasingMethod.easeOutCubic(500),radius:n.AutoEasingMethod.easeOutElastic(500)},streamChanges:{count:1e3}}}}),a.QuickSurface.instanceLayerMap.set(n.LabelInstance,{type:n.LabelLayer,defaults:function(){return{animate:{origin:n.AutoEasingMethod.easeOutCubic(500),color:n.AutoEasingMethod.easeOutCubic(500)},data:new n.InstanceProvider,key:"",resourceKey:"",scaleMode:n.ScaleMode.BOUND_MAX,truncation:"...",streamChanges:{count:1e3}}}}),a.QuickSurface.instanceLayerMap.set(n.TextAreaInstance,{type:n.TextAreaLayer,defaults:function(){return{data:new n.InstanceProvider,key:"",resourceKey:"",scaleMode:n.ScaleMode.BOUND_MAX,truncation:"...",streamChanges:{count:1e3}}}}),a.QuickSurface.instanceLayerMap.set(n.ImageInstance,{type:n.ImageLayer,defaults:function(){return{data:new n.InstanceProvider,key:"",atlas:"",rasterizationScale:1,streamChanges:{count:1e3}}}});var i={type:n.View2D,defaults:{viewport:{left:0,right:0,top:0,bottom:0},clearFlags:[],key:"",camera:new n.Camera2D}};a.QuickSurface.layerViewMap.set(n.CircleLayer,i),a.QuickSurface.layerViewMap.set(n.RingLayer,i),a.QuickSurface.layerViewMap.set(n.ArcLayer,i),a.QuickSurface.layerViewMap.set(n.LabelLayer,i),a.QuickSurface.layerViewMap.set(n.TextAreaLayer,i),a.QuickSurface.layerViewMap.set(n.EdgeLayer,i),a.QuickSurface.layerViewMap.set(n.RectangleLayer,i),a.QuickSurface.layerViewMap.set(n.ImageLayer,i),a.QuickSurface.cameraReferenceMap.set(n.Camera,(function(e){return e})),a.QuickSurface.cameraReferenceMap.set(n.Camera2D,(function(e){return new n.ReferenceCamera2D({base:e})}))}])}));
//# sourceMappingURL=index.js.map